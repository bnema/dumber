# WebKit API Migration Contract
# Defines the interface mapping between WebKit2GTK 4.0 and WebKitGTK 6.0

version: "1.0.0"
migration:
  from: "webkit2gtk-4.0"
  to: "webkitgtk-6.0"

# Core WebView Management
webview:
  creation:
    old:
      function: "webkit_web_view_new_with_context"
      params: ["WebKitWebContext*"]
      returns: "GtkWidget*"
    new:
      function: "g_object_new"
      params: ["WEBKIT_TYPE_WEB_VIEW", "properties..."]
      returns: "GtkWidget*"
    
  settings:
    hardware_acceleration:
      function: "webkit_settings_set_hardware_acceleration_policy"
      params: ["WebKitSettings*", "WebKitHardwareAccelerationPolicy"]
      values:
        - WEBKIT_HARDWARE_ACCELERATION_POLICY_ON_DEMAND
        - WEBKIT_HARDWARE_ACCELERATION_POLICY_ALWAYS
        - WEBKIT_HARDWARE_ACCELERATION_POLICY_NEVER
    
    canvas_acceleration:
      function: "webkit_settings_set_enable_2d_canvas_acceleration"
      params: ["WebKitSettings*", "gboolean"]
    
    webgl:
      function: "webkit_settings_set_enable_webgl"
      params: ["WebKitSettings*", "gboolean"]

# GTK4 Widget Changes
gtk:
  window:
    create:
      old: "gtk_window_new(GTK_WINDOW_TOPLEVEL)"
      new: "gtk_window_new()"
    
    add_child:
      old: "gtk_container_add(container, widget)"
      new: "gtk_window_set_child(window, widget)"
    
    destroy:
      old: "gtk_widget_destroy(widget)"
      new: "gtk_window_destroy(GTK_WINDOW(widget))"

  events:
    key_press:
      old:
        signal: "key-press-event"
        callback: "gboolean (*)(GtkWidget*, GdkEventKey*, gpointer)"
      new:
        controller: "gtk_event_controller_key_new()"
        signal: "key-pressed"
        callback: "gboolean (*)(GtkEventControllerKey*, guint, guint, GdkModifierType, gpointer)"
    
    button_press:
      old:
        signal: "button-press-event"
        callback: "gboolean (*)(GtkWidget*, GdkEventButton*, gpointer)"
      new:
        controller: "gtk_gesture_click_new()"
        signal: "pressed"
        callback: "void (*)(GtkGestureClick*, gint, gdouble, gdouble, gpointer)"

# Network Session (replaces WebContext)
network:
  session:
    old:
      type: "WebKitWebContext"
      data_manager: "webkit_website_data_manager_new"
    new:
      type: "WebKitNetworkSession"
      create: "webkit_network_session_new"
      ephemeral: "webkit_network_session_new_ephemeral"
      default: "webkit_network_session_get_default"

# Build Configuration
build:
  pkg_config:
    old:
      - "webkit2gtk-4.0"
      - "gtk+-3.0"
      - "javascriptcoregtk-4.0"
    new:
      - "webkitgtk-6.0"
      - "gtk4"
      - "javascriptcoregtk-6.0"
  
  headers:
    old:
      - "#include <webkit2/webkit2.h>"
      - "#include <gtk/gtk.h>"
    new:
      - "#include <webkit/webkit.h>"
      - "#include <gtk/gtk.h>"

# Compatibility Requirements
compatibility:
  minimum_gtk: "4.0"
  minimum_webkit: "2.40"  # First version with webkitgtk-6.0
  required_features:
    - hardware_acceleration_policy
    - network_session
    - sandbox_always_enabled